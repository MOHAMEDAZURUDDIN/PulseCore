import{a as h,j as r,e as o,g as l,m as G,d as O}from"./vendor-DRWF_35v.js";import{b as D,u as F,a as b,L as _,C as e,y as W,x as z}from"./index-Cyj1GRGR.js";import{u as B,a as R,C as S,b as N,c as L}from"./stripe-huBLJZ7y.js";import{v as T,C as q}from"./Shipping-C_oiWBXf.js";import{C as A}from"./CustomSnackbar-MfbZEKOq.js";function K(){const d=B(),c=R(),f=D(),g=F(),[m,p]=h.useState(!1),[y,a]=h.useState(null),{user:x}=b(n=>n.authState),{items:k,shippingInfo:t,loading:P}=b(n=>n.cartState),{loading:j}=b(n=>n.orderState),s=JSON.parse(sessionStorage.getItem("orderInfo"));h.useEffect(()=>{T(t)},[g,t]);const $={amount:Math.round(s.totalPrice*100),shipping:{name:x.name,address:{city:t.city,postal_code:t.postalCode,country:t.country,state:t.state,line1:t.address},phone:t.phoneNo}},C={orderItems:k.map(n=>({name:n.product.name,quantity:n.quantity,image:n.product.images[0],price:n.product.price,product:n.product._id})),shippingInfo:t,itemsPrice:s.itemsPrice,taxPrice:s.taxPrice,shippingPrice:s.shippingPrice,totalPrice:s.totalPrice},v=async n=>{if(n.preventDefault(),!(!d||!c||m)){p(!0),a(null);try{const u={headers:{"Content-Type":"application/json"},withCredentials:!0},{data:E}=await O.post("/api/v1/payment/process",$,u),I=E.client_secret,i=await d.confirmCardPayment(I,{payment_method:{card:c.getElement(S),billing_details:{name:x.name,email:x.email}}});i.error?(a(i.error.message),p(!1)):i.paymentIntent.status==="succeeded"?(C.paymentInfo={id:i.paymentIntent.id,status:i.paymentIntent.status},await f(W(C)),f(z()),sessionStorage.removeItem("orderInfo"),g("/order/success")):(a("Payment failed unexpectedly"),p(!1))}catch(u){a(u.message||"An error occurred during payment"),p(!1)}}},w=()=>{a(null)};return P||j||!d||!c?r.jsx(_,{}):r.jsxs(o,{sx:{minHeight:"100vh",bgcolor:e.deepBlack,position:"relative",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"center",py:8},children:[r.jsx(o,{sx:{position:"absolute",top:0,left:0,right:0,height:"50vh",background:`linear-gradient(135deg, ${e.semiDark} 0%, ${e.warning} 100%)`,clipPath:"polygon(0 0, 100% 0, 100% 60%, 0 100%)",opacity:.9,zIndex:0,animation:"pulse 4s infinite alternate","@keyframes pulse":{"0%":{opacity:.7,transform:"scale(1)"},"100%":{opacity:1,transform:"scale(1.05)"}}}}),r.jsxs(o,{sx:{zIndex:2,width:"100%",maxWidth:600,mt:10},children:[r.jsx(q,{shipping:!0,confirmOrder:!0,payment:!0}),r.jsx(l,{variant:"h2",align:"center",sx:{fontFamily:"'Orbitron', sans-serif",fontWeight:900,background:`linear-gradient(90deg, ${e.shaft}, ${e.neonPink})`,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",textShadow:`0 0 20px ${e.neonGreen}80`,mb:6},children:"Secure Payment"}),r.jsxs(o,{sx:{bgcolor:`${e.darkGray}E6`,borderRadius:4,p:4,boxShadow:`0 0 25px ${e.neonPink}4D`,border:`1px solid ${e.neonGreen}33`,backdropFilter:"blur(10px)",transition:"all 0.3s ease","&:hover":{transform:"translateY(-5px)",boxShadow:`0 0 35px ${e.neonGreen}B3`}},children:[r.jsx(l,{variant:"h5",sx:{fontFamily:"'Orbitron', sans-serif",color:e.neonGreen,fontWeight:"bold",mb:3,textAlign:"center"},children:"Enter Card Details"}),r.jsxs(o,{component:"form",onSubmit:v,children:[r.jsxs(o,{sx:{mb:3},children:[r.jsx(l,{sx:{color:e.neonPink,mb:1,fontFamily:"'Orbitron', sans-serif"},children:"Card Number"}),r.jsx(o,{sx:{p:2,bgcolor:`${e.semiDark}CC`,borderRadius:2,border:`1px solid ${e.neonGreen}80`,"&:hover":{borderColor:e.neonPink,boxShadow:`0 0 15px ${e.neonGreen}80`},transition:"all 0.3s ease"},children:r.jsx(S,{options:{style:{base:{color:e.white,fontSize:"18px",fontFamily:"'Orbitron', sans-serif","::placeholder":{color:e.dove_gray}}}}})})]}),r.jsxs(o,{sx:{mb:3},children:[r.jsx(l,{sx:{color:e.neonPink,mb:1,fontFamily:"'Orbitron', sans-serif"},children:"Expiry Date"}),r.jsx(o,{sx:{p:2,bgcolor:`${e.semiDark}CC`,borderRadius:2,border:`1px solid ${e.neonGreen}80`,"&:hover":{borderColor:e.neonPink,boxShadow:`0 0 15px ${e.neonGreen}80`},transition:"all 0.3s ease"},children:r.jsx(N,{options:{style:{base:{color:e.white,fontSize:"18px",fontFamily:"'Orbitron', sans-serif","::placeholder":{color:e.dove_gray}}}}})})]}),r.jsxs(o,{sx:{mb:4},children:[r.jsx(l,{sx:{color:e.neonPink,mb:1,fontFamily:"'Orbitron', sans-serif"},children:"CVC Code"}),r.jsx(o,{sx:{p:2,bgcolor:`${e.semiDark}CC`,borderRadius:2,border:`1px solid ${e.neonGreen}80`,"&:hover":{borderColor:e.neonPink,boxShadow:`0 0 15px ${e.neonGreen}80`},transition:"all 0.3s ease"},children:r.jsx(L,{options:{style:{base:{color:e.white,fontSize:"18px",fontFamily:"'Orbitron', sans-serif","::placeholder":{color:e.dove_gray}}}}})})]}),r.jsx(G,{type:"submit",fullWidth:!0,variant:"contained",sx:{py:1.5,background:`linear-gradient(90deg, ${e.neonGreen}, ${e.teal})`,color:e.white,fontWeight:"600",fontFamily:"'Orbitron', sans-serif",fontSize:"1.2rem",borderRadius:2,boxShadow:`0 0 20px ${e.neonGreen}80`,"&:hover":{transform:"translateY(-3px)",boxShadow:`0 0 30px ${e.neonPink}B3`,background:`linear-gradient(90deg, ${e.neonPink}, ${e.orangered})`},"&:disabled":{background:e.dove_gray,boxShadow:"none",cursor:"not-allowed"},transition:"all 0.3s ease"},disabled:!d||!c||!s||m,children:m?"Processing...":`Pay $${s==null?void 0:s.totalPrice}`})]})]})]}),r.jsx(A,{open:!!y,message:y||"Payment failed",severity:"error",handleClose:w})]})}export{K as default};
